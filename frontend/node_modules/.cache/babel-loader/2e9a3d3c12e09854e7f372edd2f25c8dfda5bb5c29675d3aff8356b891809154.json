{"ast":null,"code":"import * as d3 from \"d3\";\nfunction purifyString(str) {\n  // Regular expression to match content inside brackets with optional spaces\n  var regex = /\\s*\\[[^\\]]*\\]\\s*/g;\n\n  // Replace content inside brackets and the brackets themselves with an empty string\n  return str.replace(regex, \"\");\n}\nexport function createWorldMap({\n  selected_year,\n  selectedCountry,\n  handleCountryChange\n}) {\n  var svg = d3.select(\"#world_map\"),\n    width = +svg.attr(\"width\"),\n    height = +svg.attr(\"height\");\n  var Tooltip = d3.select(\"#world_map\").append(\"div\").style(\"opacity\", 0).attr(\"class\", \"tooltip\").style(\"background-color\", \"white\").style(\"border\", \"solid\").style(\"border-width\", \"2px\").style(\"border-radius\", \"5px\").style(\"padding\", \"5px\");\n  // Map and projection\n  var path = d3.geoPath();\n  var projection = d3.geoMercator().scale(70).center([0, 20]).translate([width / 2, height / 2]);\n\n  // Data and color scale\n  var colorScale = d3.scaleThreshold().domain([1, 3, 5, 7]).range([\"red\", \"orange\", \"yellow\", \"mediumseagreen\", \"green\"]);\n\n  // Load external data and boot\n  d3.queue().defer(d3.json, process.env.PUBLIC_URL + \"/data/world_countries.json\").defer(d3.csv, process.env.PUBLIC_URL + \"/data/country-codes.csv\").defer(d3.csv, process.env.PUBLIC_URL + \"/data/sustainable-score-\" + selected_year + \".csv\").await(createMap);\n  function createMap(error, topo, codes, score) {\n    if (error) throw error;\n\n    // Create a map of country scores\n    var hapinessScoreMap = new Map(score.map(d => [d.country, +d.happiness_score]));\n    var sustainableScoreMap = new Map(score.map(d => [d.country, +d.sustainable_index_score]));\n    var countryCodes = new Map(codes.map(x => [x.alpha3, x.country]));\n    // Draw the map\n\n    var mouseover = function (t, c, s) {\n      Tooltip.style(\"opacity\", 1);\n      d3.select(this).style(\"stroke\", \"black\").style(\"opacity\", 1);\n      var countryCode = t.id;\n      var countryName = countryCodes.get(countryCode) || \"\";\n      var countryScore = hapinessScoreMap.get(countryName) || \"No Data\";\n    };\n    var mousemove = function (t, c, s) {\n      Tooltip.html(\"The exact value of<br>this cell is: \").style(\"left\", d3.mouse(this)[0] + 70 + \"px\").style(\"top\", d3.mouse(this)[1] + \"px\");\n    };\n    var mouseleave = function (t, c, s) {\n      Tooltip.style(\"opacity\", 0);\n      d3.select(this).style(\"stroke\", \"none\").style(\"opacity\", 0.8);\n    };\n    var mouseclick = function (t, c, s) {\n      var countryCode = t.id;\n      var countryName = countryCodes.get(countryCode) || \"\";\n      handleCountryChange(countryName);\n    };\n    svg.selectAll(\"path\").data(topo.features).enter().append(\"path\").attr(\"d\", path.projection(projection))\n    // tooltips\n    .style(\"stroke\", \"white\").style(\"stroke-width\", 0.3).attr(\"fill\", function (t, c, s) {\n      var countryCode = t.id;\n      var countryName = countryCodes.get(countryCode) || \"\";\n      var happinessScore = hapinessScoreMap.get(purifyString(countryName)) || 0;\n      if (happinessScore === 0) {\n        console.log(countryName, purifyString(countryName));\n      }\n      // var sustainableScore = sustainableScoreMap.get(countryName) || 0;\n      return colorScale(happinessScore);\n    }).style(\"stroke-width\", 2).style(\"stroke\", \"white\").style(\"opacity\", 0.8).on(\"mouseover\", mouseover).on(\"mousemove\", mousemove).on(\"mouseleave\", mouseleave).on(\"click\", mouseclick);\n  }\n\n  // Create tooltip\n  var tooltip = d3.select(\"body\").append(\"div\").attr(\"class\", \"tooltip\").style(\"opacity\", 0);\n\n  // Remove tooltip on mouseout\n  svg.on(\"mouseout\", function () {\n    tooltip.style(\"opacity\", 0);\n  });\n}","map":{"version":3,"names":["d3","purifyString","str","regex","replace","createWorldMap","selected_year","selectedCountry","handleCountryChange","svg","select","width","attr","height","Tooltip","append","style","path","geoPath","projection","geoMercator","scale","center","translate","colorScale","scaleThreshold","domain","range","queue","defer","json","process","env","PUBLIC_URL","csv","await","createMap","error","topo","codes","score","hapinessScoreMap","Map","map","d","country","happiness_score","sustainableScoreMap","sustainable_index_score","countryCodes","x","alpha3","mouseover","t","c","s","countryCode","id","countryName","get","countryScore","mousemove","html","mouse","mouseleave","mouseclick","selectAll","data","features","enter","happinessScore","console","log","on","tooltip"],"sources":["/Users/nithinkatla00/My-projects/Viz-project/frontend/src/utils/worldMap.js"],"sourcesContent":["import * as d3 from \"d3\";\n\nfunction purifyString(str) {\n  // Regular expression to match content inside brackets with optional spaces\n  var regex = /\\s*\\[[^\\]]*\\]\\s*/g;\n\n  // Replace content inside brackets and the brackets themselves with an empty string\n  return str.replace(regex, \"\");\n}\n\nexport function createWorldMap({\n  selected_year,\n  selectedCountry,\n  handleCountryChange\n}) {\n  var svg = d3.select(\"#world_map\"),\n    width = +svg.attr(\"width\"),\n    height = +svg.attr(\"height\");\n\n  var Tooltip = d3\n    .select(\"#world_map\")\n    .append(\"div\")\n    .style(\"opacity\", 0)\n    .attr(\"class\", \"tooltip\")\n    .style(\"background-color\", \"white\")\n    .style(\"border\", \"solid\")\n    .style(\"border-width\", \"2px\")\n    .style(\"border-radius\", \"5px\")\n    .style(\"padding\", \"5px\");\n  // Map and projection\n  var path = d3.geoPath();\n  var projection = d3\n    .geoMercator()\n    .scale(70)\n    .center([0, 20])\n    .translate([width / 2, height / 2]);\n\n  // Data and color scale\n  var colorScale = d3\n    .scaleThreshold()\n    .domain([1, 3, 5, 7])\n    .range([\"red\", \"orange\", \"yellow\", \"mediumseagreen\", \"green\"]);\n\n  // Load external data and boot\n  d3.queue()\n    .defer(d3.json, process.env.PUBLIC_URL + \"/data/world_countries.json\")\n    .defer(d3.csv, process.env.PUBLIC_URL + \"/data/country-codes.csv\")\n    .defer(\n      d3.csv,\n      process.env.PUBLIC_URL +\n        \"/data/sustainable-score-\" +\n        selected_year +\n        \".csv\"\n    )\n    .await(createMap);\n\n  function createMap(error, topo, codes, score) {\n    if (error) throw error;\n\n    // Create a map of country scores\n    var hapinessScoreMap = new Map(\n      score.map((d) => [d.country, +d.happiness_score])\n    );\n\n    var sustainableScoreMap = new Map(\n      score.map((d) => [d.country, +d.sustainable_index_score])\n    );\n\n    var countryCodes = new Map(codes.map((x) => [x.alpha3, x.country]));\n    // Draw the map\n\n    var mouseover = function (t, c, s) {\n      Tooltip.style(\"opacity\", 1);\n      d3.select(this).style(\"stroke\", \"black\").style(\"opacity\", 1);\n      var countryCode = t.id;\n      var countryName = countryCodes.get(countryCode) || \"\";\n      var countryScore = hapinessScoreMap.get(countryName) || \"No Data\";\n    };\n\n    var mousemove = function (t, c, s) {\n      Tooltip.html(\"The exact value of<br>this cell is: \")\n        .style(\"left\", d3.mouse(this)[0] + 70 + \"px\")\n        .style(\"top\", d3.mouse(this)[1] + \"px\");\n    };\n\n    var mouseleave = function (t, c, s) {\n      Tooltip.style(\"opacity\", 0);\n      d3.select(this).style(\"stroke\", \"none\").style(\"opacity\", 0.8);\n    };\n\n    var mouseclick = function (t, c, s) {\n      var countryCode = t.id;\n      var countryName = countryCodes.get(countryCode) || \"\";\n      handleCountryChange(countryName);\n    };\n\n    svg\n      .selectAll(\"path\")\n      .data(topo.features)\n      .enter()\n      .append(\"path\")\n      .attr(\"d\", path.projection(projection))\n      // tooltips\n      .style(\"stroke\", \"white\")\n      .style(\"stroke-width\", 0.3)\n      .attr(\"fill\", function (t, c, s) {\n        var countryCode = t.id;\n        var countryName = countryCodes.get(countryCode) || \"\";\n        var happinessScore =\n          hapinessScoreMap.get(purifyString(countryName)) || 0;\n        if (happinessScore === 0) {\n          console.log(countryName, purifyString(countryName));\n        }\n        // var sustainableScore = sustainableScoreMap.get(countryName) || 0;\n        return colorScale(happinessScore);\n      })\n      .style(\"stroke-width\", 2)\n      .style(\"stroke\", \"white\")\n      .style(\"opacity\", 0.8)\n      .on(\"mouseover\", mouseover)\n      .on(\"mousemove\", mousemove)\n      .on(\"mouseleave\", mouseleave)\n      .on(\"click\", mouseclick);\n  }\n\n  // Create tooltip\n  var tooltip = d3\n    .select(\"body\")\n    .append(\"div\")\n    .attr(\"class\", \"tooltip\")\n    .style(\"opacity\", 0);\n\n  // Remove tooltip on mouseout\n  svg.on(\"mouseout\", function () {\n    tooltip.style(\"opacity\", 0);\n  });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}